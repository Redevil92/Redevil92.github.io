import{d as I,r as g,b,o as _,c as C,_ as P,u as V,w as R,f as z,a as S,e as k,g as B,n as D,p as T,h as q}from"./index-8lyaWh5H.js";const F=I({__name:"AudioAnalyzer",props:{audioElement:Object},setup(s){const u=s,n=g(),i=g(null),d=g(new window.AudioContext);function c(){var e;if(n.value&&i.value){const o=i.value.frequencyBinCount,t=new Uint8Array(o),a=n.value.getContext("2d");a==null||a.clearRect(0,0,n.value.width,n.value.height),(e=i.value)==null||e.getByteFrequencyData(t),p(o,t,a,n.value)}requestAnimationFrame(c)}const p=(e,o,t,a)=>{const r=getComputedStyle(document.body);t.fillStyle=r.getPropertyValue("--font-color");let l;const m=a.width/2/e;let A=0,w=e*m;t.clearRect(0,0,a.width,a.height),f();const E=255;for(let h=0;h<e;h++)l=o[h]/E*a.height,v(t,a.width/2-A,(a.height-l)/2,m/1.7,l,30),v(t,w,(a.height-l)/2,m/1.7,l,30),A+=m,w+=m},f=()=>{const e=window.devicePixelRatio;if(n.value){const o=+getComputedStyle(n.value).getPropertyValue("height").slice(0,-2),t=+getComputedStyle(n.value).getPropertyValue("width").slice(0,-2);n.value.setAttribute("height",(o*e).toString()),n.value.setAttribute("width",(t*e).toString())}},v=function(e,o,t,a,r,l){a<2*l&&(l=a/2),r<2*l&&(l=r/2);const m=getComputedStyle(document.body).getPropertyValue("--font-color");e.fillStyle=m,e.beginPath(),e.moveTo(o+l,t),e.arcTo(o+a,t,o+a,t+r,l),e.arcTo(o+a,t+r,o,t+r,l),e.arcTo(o,t+r,o,t,l),e.arcTo(o,t,o+a,t,l),e.closePath(),e.fill()},y=()=>{if(u.audioElement&&n.value){const e=d.value.createMediaElementSource(u.audioElement);i.value=d.value.createAnalyser(),e.connect(i.value),i.value.connect(d.value.destination),i.value.smoothingTimeConstant=.9,i.value.fftSize=32,c()}};return b(async()=>{y()}),(e,o)=>(_(),C("canvas",{id:"canvas-audio",ref_key:"canvasRef",ref:n,class:"audio-canvas"},null,512))}}),N=P(F,[["__scopeId","data-v-55c776c3"]]),$=s=>(T("data-v-a0bc6c8f"),s=s(),q(),s),j=$(()=>S("div",{id:"waveform"},null,-1)),M=["src"],O=I({__name:"AudioPlayer",props:{itemDialog:Object,height:{type:Number,required:!0}},setup(s){const u=s,n=V(),i=g(),d=g();return R(()=>{var c;return(c=u.itemDialog)==null?void 0:c.isCollapsed},async function(c,p){var f,v;if(c){const y={componentPath:"audioItem/AudioWidget.vue",itemDialogGuid:((f=u.itemDialog)==null?void 0:f.guid)||"",audioElement:i.value};n.addDynamicIslandItem(y)}else n.removeDynamicIslandItem(((v=u.itemDialog)==null?void 0:v.guid)||"")}),b(async()=>{var c,p;if((c=u.itemDialog)!=null&&c.path){const f=await z.readFile((p=u.itemDialog)==null?void 0:p.path);d.value=f}}),(c,p)=>(_(),C("div",{style:D([`height: ${s.height}px; width: calc(100% -4px); `,{position:"relative"}])},[j,S("div",{style:D(`height: ${s.height-80}px; padding: calc(var(--margin)*2) `)},[d.value?(_(),k(N,{key:0,audioElement:i.value},null,8,["audioElement"])):B("",!0)],4),S("audio",{autoplay:"",class:"audio-controls",id:"audio",controls:"",ref_key:"audioRef",ref:i,src:d.value},null,8,M)],4))}}),X=P(O,[["__scopeId","data-v-a0bc6c8f"]]);export{X as default};
